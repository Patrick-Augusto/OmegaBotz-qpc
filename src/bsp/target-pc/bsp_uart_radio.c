/***************************************************************************************************
 * INCLUDES
 **************************************************************************************************/

#include <stdbool.h>
#include <stdio.h>
#include "bsp_uart_radio.h"
#include "utils.h"
/***************************************************************************************************
 * LOCAL DEFINES
 **************************************************************************************************/
#define RADIO_UART_CHANNELS  9
static uint16_t channels[RADIO_UART_CHANNELS] = {0};


/***************************************************************************************************
 * LOCAL TYPEDEFS
 **************************************************************************************************/

/***************************************************************************************************
 * LOCAL FUNCTION PROTOTYPES
 **************************************************************************************************/

/***************************************************************************************************
 * LOCAL VARIABLES
 **************************************************************************************************/
static bsp_uart_radio_callback_t external_callback;
static bool stop_uart;


/***************************************************************************************************
 * GLOBAL VARIABLES
 **************************************************************************************************/

/***************************************************************************************************
 * LOCAL FUNCTIONS
 **************************************************************************************************/

void HAL_UART_Fake_RadioData(uint8_t channel, uint16_t data) {

    channels[channel] = map(data, 0, 255, RX_RADIO_MIN_VALUE, RX_RADIO_MAX_VALUE);

    // Fake implementation of uart radio service
    if (channel == 3){
        if (!stop_uart){
            external_callback(channels, RADIO_UART_CHANNELS);
        }
    }


}


/***************************************************************************************************
 * GLOBAL FUNCTIONS
 **************************************************************************************************/


void bsp_uart_radio_init() {
    printf("UART RADIO INIT \r\n");
    stop_uart = false;
}

void bsp_uart_radio_start() {
    stop_uart = false;
}

void bsp_uart_radio_stop() {
    stop_uart = true;
}


void bsp_uart_radio_register_callback(bsp_uart_radio_callback_t callback_function){
    external_callback = callback_function;
}